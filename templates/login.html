<!DOCTYPE html>
<html>
<head>
    <title>Giriş Yap</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h2>Giriş Yap</h2>
        <form method="post" action="/api/login/">
        {% csrf_token %}
        <label for="username">Kullanıcı Adı:</label>
        <input type="text" id="username" name="username" required><br><br>
        <label for="password">Şifre:</label>
        <input type="password" id="password" name="password" required><br><br>
        <button type="submit"  onclick ="redirect()">Giriş Yap</button>
        
    </form>
    <script>
        function redirect() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            
            $.ajax({
                url: "/api/login/",
                type: "POST",
                data: { username: username, password: password },
                
                success: function(response) {

                    const token = response.access_token;
                    document.cookie = `apiData=${JSON.stringify({ access_token: token })}; expires= Thu, 21 Aug 2025 20:00:00 UTC; path=/ `;
                    window.location.href = "/";

    
                },
                error: function(error) {
                    console.error(error);

                }
            });
            $(document).ready(function() {
                handleUserLogin();  
            })
        }
      </script>
</body>
</html>